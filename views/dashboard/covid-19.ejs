<!DOCTYPE html>
<html lang="en">

<%- include("../layout/head.ejs")%>

<body>
    <!-- BEGIN LOADER -->
    <div id="load_screen">
        <div class="loader">
            <div class="loader-content">
                <div class="spinner-grow align-self-center"></div>
            </div>
        </div>
    </div>
    <!--  END LOADER -->

    <%- include("../layout/general-navbar.ejs") %>

    <!--  BEGIN MAIN CONTAINER  -->
    <div class="main-container" id="container">

        <div class="overlay"></div>
        <div class="search-overlay"></div>

        <%- include("../layout/general-sidebar.ejs") %>

        <!--  BEGIN CONTENT AREA  -->
        <div id="content" class="main-content">
            <div class="layout-px-spacing">
                <h3 style="padding-top: 15px;">Dashboard Pasien COVID-19</h3>
                <div class="row layout-top-spacing">
                    <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">

                        <div class="widget widget-account-invoice-one">
                            <div class="widget-content">
                                <div class="invoice-box">
                                    <div class="acc-total-info">
                                        <h5>Jumlah Personal Dipantau</h5>
                                        <h1 class="acc-amount" style="color: red;"><%= data.length %></h1>
                                        <p style="text-align: center;">
                                            <%= new Date().getDate()+'-'+(new Date().getMonth()+1)+'-'+new Date().getFullYear() %>
                                        </p>
                                    </div>
                                    <div class="inv-detail">
                                        <div class="info-detail-1">
                                            <p>Total Positif</p>
                                            <p style="color: yellow;"><%= dataPositif.length %></p>
                                        </div>
                                        <div class="info-detail-2">
                                            <p>Total PDP</p>
                                            <p style="color: green;"><%= dataPDP.length %></p>
                                        </div>
                                        <div class="info-detail-2">
                                            <p>Total ODP</p>
                                            <p style="color: red;"><%= dataODP.length %></p>
                                        </div>
                                        <div class="info-detail-2">
                                            <p>Total OTG</p>
                                            <p style="color: green;"><%= dataOTG.length %></p>
                                        </div>
                                        <br>
                                    </div>
                                    <div class="inv-action">
                                        <a href="" class="btn btn-dark">Detail</a>
                                        <a href="" class="btn btn-danger">Telpon</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-12 layout-spacing">
                        <div class="widget-three">
                            <div class="widget-heading">
                                <h5 class="">Kategori</h5>
                            </div>
                            <div class="widget-content">
                                <div class="order-summary">
                                    <div class="summary-list">
                                        <div class="w-summary-details">
                                            <div class="w-summary-info">
                                                <h6 style="text-align: center;">Jumlah Pasien Total</h6>
                                                <p class="summary-count"><%= data.length %></p>
                                            </div>

                                            <div class="w-summary-stats">
                                                <div class="progress">
                                                    <div class="progress-bar bg-gradient-secondary" role="progressbar"
                                                        style="width: <%= (parseInt(data.length)/parseInt(data.length)*100) %>%" aria-valuenow="90" aria-valuemin="0"
                                                        aria-valuemax="100"></div>
                                                </div>
                                            </div>

                                        </div>

                                    </div>

                                    <div class="summary-list">
                                        <div class="w-summary-details">

                                            <div class="w-summary-info">
                                                <h6>Jumlah Pasien Hidup</h6>
                                                <p class="summary-count"><%= dataHidup.length %></p>
                                            </div>

                                            <div class="w-summary-stats">
                                                <div class="progress">
                                                    <div class="progress-bar bg-gradient-success" role="progressbar"
                                                        style="width: <%= (parseInt(dataHidup.length)/parseInt(data.length)*100) %>%" aria-valuenow="65" aria-valuemin="0"
                                                        aria-valuemax="100"></div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="summary-list">
                                        <div class="w-summary-details">

                                            <div class="w-summary-info">
                                                <h6>Jumlah Pasien Meninggal</h6>
                                                <p class="summary-count"><%= dataMeninggal.length %></p>
                                            </div>

                                            <div class="w-summary-stats">
                                                <div class="progress">
                                                    <div class="progress-bar bg-gradient-danger" role="progressbar"
                                                        style="width: <%= (parseInt(dataMeninggal.length)/parseInt(data.length)*100) %>%" aria-valuenow="65" aria-valuemin="0"
                                                        aria-valuemax="100"></div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="summary-list">
                                        <div class="w-summary-details">

                                            <div class="w-summary-info">
                                                <h6>Jumlah PDP Kritis</h6>
                                                <p class="summary-count"><%= dataPDP.length %></p>
                                            </div>

                                            <div class="w-summary-stats">
                                                <div class="progress">
                                                    <div class="progress-bar bg-gradient-danger" role="progressbar"
                                                        style="width: <%= (parseInt(dataPDP.length)/parseInt(data.length)*100) %>%" aria-valuenow="65" aria-valuemin="0"
                                                        aria-valuemax="100"></div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="summary-list">
                                        <div class="w-summary-details">

                                            <div class="w-summary-info">
                                                <h6>Emergency</h6>
                                                <p class="summary-count"><%= dataEmergency.length %></p>
                                            </div>

                                            <div class="w-summary-stats">
                                                <div class="progress">
                                                    <div class="progress-bar bg-gradient-danger" role="progressbar"
                                                        style="width: <%= (parseInt(dataEmergency.length)/parseInt(data.length)*100) %>%" aria-valuenow="80" aria-valuemin="0"
                                                        aria-valuemax="100"></div>
                                                </div>
                                            </div>

                                        </div>

                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="col-xl-4 col-lg-12 col-md-6 col-sm-12 col-12 layout-spacing">
                        <div class="widget widget-activity-four">

                            <div class="widget-heading">
                                <h5 class="">Recent Activities</h5>
                            </div>

                            <div class="widget-content">

                                <div class="mt-container mx-auto">
                                    <div class="timeline-line">

                                        <div class="item-timeline timeline-primary">
                                            <div class="t-dot" data-original-title="" title="">
                                            </div>
                                            <div class="t-text">
                                                <p><span>Updated</span> Server Logs</p>
                                                <span class="badge badge-danger">Pending</span>
                                                <p class="t-time">Just Now</p>
                                            </div>
                                        </div>

                                        <div class="item-timeline timeline-success">
                                            <div class="t-dot" data-original-title="" title="">
                                            </div>
                                            <div class="t-text">
                                                <p>Send Mail to <a href="javascript:void(0);">HR</a> and <a
                                                        href="javascript:void(0);">Admin</a></p>
                                                <span class="badge badge-success">Completed</span>
                                                <p class="t-time">2 min ago</p>
                                            </div>
                                        </div>

                                        <div class="item-timeline  timeline-danger">
                                            <div class="t-dot" data-original-title="" title="">
                                            </div>
                                            <div class="t-text">
                                                <p>Backup <span>Files EOD</span></p>
                                                <span class="badge badge-danger">Pending</span>
                                                <p class="t-time">14:00</p>
                                            </div>
                                        </div>

                                        <div class="item-timeline  timeline-dark">
                                            <div class="t-dot" data-original-title="" title="">
                                            </div>
                                            <div class="t-text">
                                                <p>Collect documents from <a href="javascript:void(0);">Sara</a></p>
                                                <span class="badge badge-success">Completed</span>
                                                <p class="t-time">16:00</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tm-action-btn">
                                    <button class="btn">View All <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                            height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                            class="feather feather-chevron-down">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-12 col-md-12 col-sm-12 layout-spacing">
                        <div class="widget widget-table-one">
                            <div class="widget-heading">
                                <h5 class="">Jumlah Pasien Dengan Gejala 1</h5>
                            </div>
                            <div class="widget-content">
                                <div class="transactions-list">
                                    <div class="t-item">
                                        <div class="t-company-name">
                                            <div class="t-name">
                                                <h4>Batuk</h4>
                                                <p class="meta-date"><%= new Date().getDate()+'-'+(new Date().getMonth()+1)+'-'+new Date().getFullYear() %></p>
                                            </div>
                                        </div>
                                        <div class="t-rate rate-dec">
                                            <p><span><%= dataBatuk.length %></span></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="transactions-list">
                                    <div class="t-item">
                                        <div class="t-company-name">
                                            <div class="t-name">
                                                <h4>Pusing</h4>
                                                <p class="meta-date"><%= new Date().getDate()+'-'+(new Date().getMonth()+1)+'-'+new Date().getFullYear() %></p>
                                            </div>
                                        </div>
                                        <div class="t-rate rate-dec">
                                            <p><span><%= dataPusing.length %></span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-12 col-md-12 col-sm-12 layout-spacing">
                        <div class="widget widget-table-one">
                            <div class="widget-heading">
                                <h5 class="">Jumlah Pasien Dengan Gejala 2</h5>
                            </div>
                            <div class="widget-content">
                                <div class="transactions-list">
                                    <div class="t-item">
                                        <div class="t-company-name">
                                            <div class="t-name">
                                                <h4>Demam</h4>
                                                <p class="meta-date"><%= new Date().getDate()+'-'+(new Date().getMonth()+1)+'-'+new Date().getFullYear() %></p>
                                            </div>
                                        </div>
                                        <div class="t-rate rate-dec">
                                            <p><span><%= dataDemam.length %></span></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="transactions-list">
                                    <div class="t-item">
                                        <div class="t-company-name">
                                            <div class="t-name">
                                                <h4>Sesak Nafas</h4>
                                                <p class="meta-date"><%= new Date().getDate()+'-'+(new Date().getMonth()+1)+'-'+new Date().getFullYear() %></p>
                                            </div>
                                        </div>
                                        <div class="t-rate rate-dec">
                                            <p><span><%= dataSesak.length %></span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-12 col-lg-12 col-sm-12 layout-spacing">
                        <div class="widget-content widget-content-area br-6">
                            <div class="table-responsive mb-4 mt-4">
                                <table id="zero-config" class="table table-hover" style="width:100%">
                                    <h5 style="left: 30px;">Daftar Pasien Belum Minum Obat</h5>
                                    <thead>
                                        <tr>
                                            <th>Nama</th>
                                            <th>Dokter</th>
                                            <th>Pendamping</th>
                                            <th>No HP</th>
                                            <th>Kategori</th>
                                            <th>Jenis Kelamin</th>
                                            <th class="no-content">Detail</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% for(let pasien = 0; pasien <= data.length-1; pasien++) {%>
                                        <tr>
                                            <td><%= data[pasien].nama %></td>
                                            <td><%= data[pasien].dokter.nama_lengkap %></td>
                                            <td><%= data[pasien].nama_pendamping %></td>
                                            <td><%= data[pasien].no_hp %></td>
                                            <td><%= data[pasien].kategori %></td>
                                            <td><%= data[pasien].jenis_kelamin %></td>
                                            <td><a href="/page/covid-pasien-detail-page/<%= data[pasien]._id %>">Info</a>
                                            </td>
                                        </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
    
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
                        <div class="widget widget-chart-one" style="height: 500px;">
                            <div class="widget-heading">
                                <h5 class="">Distribusi Lokasi Pasien</h5>
                                <ul class="tabs tab-pills">
                                    <li><a href="javascript:void(0);" id="tb_1" class="tabmenu">Detail</a></li>
                                </ul>
                            </div>
                            <div id='map_distribusi' style='width: 100%; height: 90%;'></div>
                        </div>
                    </div>
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
                        <div class="widget widget-chart-one" style="height: 500px;">
                            <div class="widget-heading">
                                <h5 class="">Lokasi Rumah Sakit Rujukan: 5</h5>
                                <ul class="tabs tab-pills">
                                    <li><a href="javascript:void(0);" id="tb_1" class="tabmenu">Detail</a></li>
                                </ul>
                            </div>
                            <div id='map_rujukan' style='width: 100%; height: 90%;'></div>
                        </div>
                    </div>
    
                    <div class="col-xl-6 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
                        <div class="widget widget-chart-two" style="height: 500px;">
                            <div class="widget-heading">
                                <h5 class="">Pasien</h5>
                            </div>
                            <div class="widget-content" style="height: 500px;">
                                <div id="chart-pasien" class=""></div>
                            </div>
                        </div>
                    </div>
    
                    <div class="col-xl-6 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
                        <div class="widget widget-account-invoice-one" style="height: 500px;">
    
                            <div class="widget-heading">
                                <h1 style="text-align: center;">Call Center</h1>
                            </div>
    
                            <div class="widget-content">
                                <div class="invoice-box">
                                    <div class="acc-total-info">
                                        <p>Laporkan jika anda memiliki kondisi atau gejala-gejala sebagai berikut: </p>
                                        <ul>
                                            <li>Batuk Kering</li>
                                            <li>Sakit Tenggorokan</li>
                                            <li>Lemas Badan</li>
                                            <li>Sesak Nafas</li>
                                            <li>Mual</li>
                                            <li>Pusing</li>
                                            <li>Pencernaan Terganggu</li>
                                            <li>Kemungkinan Pasien Baru</li>
                                            <li>Riwayat keluar kota</li>
                                        </ul>
                                        <p class="acc-amount">911</p>
                                        <p style="text-align: center;">Rumah Sakit Dr Soetomo Surabaya</p>
                                    </div>
                                    <div class="inv-action">
                                        <a href="" class="btn btn-danger" style="width: 100%;">Report</a>
                                    </div>
                                </div>
                            </div>
    
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <%- include("../layout/footer.ejs") %>
    </div>
    <!--  END CONTENT AREA  -->

    </div>
    <!-- END MAIN CONTAINER -->

    <!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
    <script src="../assets/js/libs/jquery-3.1.1.min.js"></script>
    <script src="../bootstrap/js/popper.min.js"></script>
    <script src="../bootstrap/js/bootstrap.min.js"></script>
    <script src="../plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="../assets/js/app.js"></script>

    <script>
        $(document).ready(function () {
            App.init();
        });
    </script>
    <script src="../assets/js/custom.js"></script>
    <!-- END GLOBAL MANDATORY SCRIPTS -->

    <!-- BEGIN PAGE LEVEL SCRIPTS -->
    <script src="../plugins/table/datatable/datatables.js"></script>
    <script>
        $('#zero-config').DataTable({
            "oLanguage": {
                "oPaginate": { "sPrevious": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>', "sNext": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>' },
                "sInfo": "Showing page _PAGE_ of _PAGES_",
                "sSearch": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',
                "sSearchPlaceholder": "Search...",
                "sLengthMenu": "Results :  _MENU_",
            },
            "stripeClasses": [],
            "lengthMenu": [7, 10, 20, 50],
            "pageLength": 7
        });
    </script>
    <script>
        /*
    ==================================
        Sales By Category | Options
    ==================================
*/
        var options = {
            chart: {
                type: 'donut',
                width: 380
            },
            colors: ['#5c1ac3', '#e2a03f', '#e7515a', '#e2a03f'],
            dataLabels: {
                enabled: false
            },
            legend: {
                position: 'bottom',
                horizontalAlign: 'center',
                fontSize: '14px',
                markers: {
                    width: 10,
                    height: 10,
                },
                itemMargin: {
                    horizontal: 0,
                    vertical: 8
                }
            },
            plotOptions: {
                pie: {
                    donut: {
                        size: '65%',
                        background: 'transparent',
                        labels: {
                            show: true,
                            name: {
                                show: true,
                                fontSize: '29px',
                                fontFamily: 'Nunito, sans-serif',
                                color: undefined,
                                offsetY: -10
                            },
                            value: {
                                show: true,
                                fontSize: '26px',
                                fontFamily: 'Nunito, sans-serif',
                                color: '#bfc9d4',
                                offsetY: 16,
                                formatter: function (val) {
                                    return val
                                }
                            },
                            total: {
                                show: true,
                                showAlways: true,
                                label: 'Total',
                                color: '#888ea8',
                                formatter: function (w) {
                                    return w.globals.seriesTotals.reduce(function (a, b) {
                                        return a + b
                                    }, 0)
                                }
                            }
                        }
                    }
                }
            },
            stroke: {
                show: true,
                width: 25,
                colors: '#0e1726'
            },
            series: [1759, 737, 270],
            labels: ['Positif', 'ODP', 'PDP'],
            responsive: [{
                breakpoint: 1599,
                options: {
                    chart: {
                        width: '350px',
                        height: '400px'
                    },
                    legend: {
                        position: 'bottom'
                    }
                },

                breakpoint: 1439,
                options: {
                    chart: {
                        width: '250px',
                        height: '390px'
                    },
                    legend: {
                        position: 'bottom'
                    },
                    plotOptions: {
                        pie: {
                            donut: {
                                size: '65%',
                            }
                        }
                    }
                },
            }]
        }

        var chart = new ApexCharts(
            document.querySelector("#chart-pasien"),
            options
        );

        chart.render();
    </script>
    <script>
        $.get("<%= apiMap %>").done(locations => {
            mapboxgl.accessToken = "<%= hostMap %>";
            let features = []
            console.log(locations)
            locations.forEach(data => {
                let eachData = {
                    'type': 'Feature',
                    'properties': {
                        'description':
                            `<strong style="color:#000000">Coba</strong>
                            <li style="color:#000000">Coba</li>
                            <br>
                            <a style="color:#0000ff" href="http://www.mtpleasantdc.com/makeitmtpleasant" target="_blank" title="Opens in a new window">Detail Info</a>`
                    },
                    'geometry': {
                        'type': 'Point',
                        'coordinates': [data.long, data.lat]
                    }
                }
                console.log(eachData)
                features.push(eachData)
            })

            var map_rujukan = new mapboxgl.Map({
                container: 'map_rujukan',
                style: 'mapbox://styles/mapbox/streets-v9',
                center: [104.179182, -3.139221],
                zoom: 7
            });

            var size = 150;

            // implementation of CustomLayerInterface to draw a pulsing dot icon on the map
            // see https://docs.mapbox.com/mapbox-gl-js/api/#customlayerinterface for more info
            var pulsingDot = {
                width: size,
                height: size,
                data: new Uint8Array(size * size * 4),

                // get rendering context for the map canvas when layer is added to the map
                onAdd: function () {
                    var canvas = document.createElement('canvas');
                    canvas.width = this.width;
                    canvas.height = this.height;
                    this.context = canvas.getContext('2d');
                },

                // called once before every frame where the icon will be used
                render: function () {
                    var duration = 1000;
                    var t = (performance.now() % duration) / duration;

                    var radius = (size / 2) * 0.3;
                    var outerRadius = (size / 2) * 0.7 * t + radius;
                    var context = this.context;

                    // draw outer circle
                    context.clearRect(0, 0, this.width, this.height);
                    context.beginPath();
                    context.arc(
                        this.width / 2,
                        this.height / 2,
                        outerRadius,
                        0,
                        Math.PI * 2
                    );
                    context.fillStyle = 'rgba(255, 200, 200,' + (1 - t) + ')';
                    context.fill();

                    // draw inner circle
                    context.beginPath();
                    context.arc(
                        this.width / 2,
                        this.height / 2,
                        radius,
                        0,
                        Math.PI * 2
                    );

                    context.fillStyle = 'rgba(255, 100, 100, 1)';
                    context.strokeStyle = 'white';
                    context.lineWidth = 2 + 4 * (1 - t);
                    context.fill();
                    context.stroke();

                    // update this image's data with data from the canvas
                    this.data = context.getImageData(
                        0,
                        0,
                        this.width,
                        this.height
                    ).data;

                    // continuously repaint the map, resulting in the smooth animation of the dot
                    map_rujukan.triggerRepaint();

                    // return `true` to let the map know that the image was updated
                    return true;
                }
            };

            map_rujukan.on('load', function () {
                map_rujukan.addImage('pulsing-dot', pulsingDot, { pixelRatio: 2 });
                map_rujukan.addSource('points', {
                    'type': 'geojson',
                    'data': {
                        'type': 'FeatureCollection',
                        'features': features
                    }
                });
                map_rujukan.addLayer({
                    'id': 'points',
                    'type': 'symbol',
                    'source': 'points',
                    'layout': {
                        'icon-image': 'pulsing-dot'
                    }
                });
            });
        })

        map_rujukan.on('click', 'places', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var description = e.features[0].properties.description;

            // Ensure that if the map is zoomed out such that multiple
            // copies of the feature are visible, the popup appears
            // over the copy being pointed to.
            while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
            }

            new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(description)
                .addTo(map_rujukan);
        });

        // Change the cursor to a pointer when the mouse is over the places layer.
        map_rujukan.on('mouseenter', 'places', function () {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change it back to a pointer when it leaves.
        map_rujukan.on('mouseleave', 'places', function () {
            map.getCanvas().style.cursor = '';
        });

    </script>
    <script>
        let YOUR_API_KEY = "<%= apiMap %>"
        let containers = ["map_distribusi"]
        
        console.log("<%= hostMap %>"+"/pasienCovid/findAllPasien")
        let urls = ["<%= hostMap %>" + "/pasienCovid/findAllPasien"]
        for (let i = 0; i < containers.length; i++) {
            let locations_map = []
            $.get(urls[i]).done(locations => {
                mapboxgl.accessToken = YOUR_API_KEY;
                var map = new mapboxgl.Map({
                    container: containers[i],
                    style: 'mapbox://styles/mapbox/streets-v11',
                    zoom: 8.7,
                    center: [112.808304, -7.275973]
                });

                map.on('load', function () {
                    /* Image: An image is loaded and added to the map. */
                    map.loadImage("https://i.imgur.com/MK4NUzI.png", function (error, image) {
                        if (error) throw error;
                        map.addImage("custom-marker", image);
                        /* Style layer: A style layer ties together the source and image and specifies how they are displayed on the map. */
                        locations.map(data => {
                            console.log(data)
                            let locations_for_map = {
                                type: 'Feature',
                                'properties': {
                                    'description':
                                        `<strong style="color:#000000">${data.nama}</strong>
                                <li style="color:#000000">${data.kategori}</li>
                                <br>
                                <a style="color:#0000ff" href="http://www.mtpleasantdc.com/makeitmtpleasant" target="_blank" title="Opens in a new window">Detail Info</a>`
                                },
                                'geometry': {
                                    'type': 'Point',
                                    'coordinates': [data.long, data.lat]
                                }
                            }
                            locations_map.push(locations_for_map)
                        });
                        console.log(locations_map)
                        map.addSource('places', {
                            'type': 'geojson',
                            'data': {
                                'type': 'FeatureCollection',
                                'features': locations_map
                            }
                        })
                        // Add a layer showing the places.
                        map.addLayer({
                            'id': 'places',
                            'type': 'symbol',
                            'source': 'places',
                            layout: { "icon-image": "custom-marker", }
                        });
                    })


                    // When a click event occurs on a feature in the places layer, open a popup at the
                    // location of the feature, with description HTML from its properties.
                    map.on('click', 'places', function (e) {
                        var coordinates = e.features[0].geometry.coordinates.slice();
                        var description = e.features[0].properties.description;

                        // Ensure that if the map is zoomed out such that multiple
                        // copies of the feature are visible, the popup appears
                        // over the copy being pointed to.
                        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                            coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                        }

                        new mapboxgl.Popup()
                            .setLngLat(coordinates)
                            .setHTML(description)
                            .addTo(map);
                    });

                    // Change the cursor to a pointer when the mouse is over the places layer.
                    map.on('mouseenter', 'places', function () {
                        map.getCanvas().style.cursor = 'pointer';
                    });

                    // Change it back to a pointer when it leaves.
                    map.on('mouseleave', 'places', function () {
                        map.getCanvas().style.cursor = '';
                    });
                });
            });

        }
    </script>

    <script>
        $(document).ready(function () {
            App.init();
        });
    </script>
    <script src="assets/js/custom.js"></script>
    <!-- END GLOBAL MANDATORY SCRIPTS -->
    <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
    <script src="plugins/apex/apexcharts.min.js"></script>
    <script src="assets/js/widgets/modules-widgets.js"></script>
    <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
</body>

</html>
